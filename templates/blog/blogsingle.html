{% extends 'blog/base.html' %}
{% block title %}{{post.title_tag}}{% endblock title%}
{% load hitcount_tags %}
{% load static %}
{% block search_block %}
<div class="container mb-5" data-aos-duration="600" data-aos="fade-in" style="height: 120px;width:100vh;box-shadow: 0 4px 16px rgb(0 0 0 / 10%);">
    <center style="text-align: center;vertical-align: middle;line-height: 120px; ">ADS TO BE SHOWN HERE</center>
</div>
{% endblock search_block %}
{% block article %}
<article class="entry entry-single">
    <div class="entry-img">
        <img src="{{post.entry_img}}" alt="blog_img" class="img-fluid">
    </div>
    <h2 class="entry-title">{{post.title}}</h2>
    <ul class="entry-meta" style="color:#c2c2c2;list-style-type: none;font-size:14px;padding-left:0px;">
        <li><i class="bi bi-eye"></i> {% get_hit_count for post %} | <i class="bi bi-calendar2-check"></i> Last updated {{post.modified}} | <i class="bi bi-heart-fill"><span id="like_count">&nbsp;{{post.likes_count}}</span></i></li>
    </ul>
    {% if request.user.is_authenticated %}
        <script>
            $(document).on('click', '.like-button', function (e) {
                e.preventDefault();
                $.ajax({
                type: 'POST',
                url: '{% url "blog:like" %}',
                data: {
                    postid: $('.like-button').val(),
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    action: 'post'
                },
                success: function (json) {
                    document.getElementById("like_count").innerHTML = json['result']
                    $("#like-icon").toggleClass("bi bi-heart bi bi-heart-fill");
                },
                error: function (xhr, errmsg, err) {

                }
                });
            })
        </script>
    {% else %}
        <script>
            $(document).on('click','.like-button',function(e){
                console.log("User login reqired");
            })
        </script>
    {% endif %}
    
    <div class="entry-content">
        {{post.body|safe}}
    </div>
    <div class="entry-footer">
        <i class="bi bi-folder"></i>
        <ul class="cats">
            <li><a href="#">Business</a></li>
        </ul>
        <i class="bi bi-tags"></i>
        <ul class="tags">
            {% for tag in post.tags.all %}
            <li><a href="{% url 'blog:post_list_by_tags' tag.slug %}">{{tag}}</a></li>
            {% endfor %}
        </ul>
    </div>
</article>
<div class="blog-author d-flex align-items-center">
    <img src="{% static 'IndexHome/assets/img/blog/blog-author.jpg' %}" class="rounded-circle float-left" alt="">
    <div>
        <h4>{{post.author}}</h4>
        <div class="social-links">
            <a href="https://twitters.com/#"><i class="bi bi-twitter"></i></a>
            <a href="https://facebook.com/#"><i class="bi bi-facebook"></i></a>
            <a href="https://instagram.com/#"><i class="biu bi-instagram"></i></a>
        </div>
        <p>
            {{post.author_conculsion}}
        </p>
    </div>
</div>
{% endblock article %}
{% block profile %}
<div class="sidebar" style="background:#ffffff">
    <h3 class="sidebar-title mb-4">Author's Bio</h3>
    <div class="card-container" style="background-color: #ffffff;margin:0 auto;">
        <span class="pro">PRO</span>
        <img class="round" src="https://randomuser.me/api/portraits/women/79.jpg" alt="user" />
        <h3>{{post.author}}</h3>
        <p>{{post.designation}}</p>
        <div class="buttons">
            <button class="primary">Message</button>
            <button class="primary ghost">Following</button>
        </div>
        <style>
            .skills li:hover{
            background: #03BFCB;
            color: #ffffff;
            }
        </style>
        <div class="skills" style="background-color: #ffffff;">
            <h6>Skills</h6>
            <ul>
                {% for sk in skill %}
                <li>{{sk}}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock profile %}
{% block sidebar %}
<!-- Adding author profile -->
{% if similar_post%}
<div class="sidebar">
    <h3 class="sidebar-title  mb-4" style="font-size: 24px;">Posts You May Like</h3>
    <div class="sidebar-item recent-posts">
        {% for item in similar_post %}
        <div class="post-item clearfix">
            <img src="{{item.entry_img}}" alt="">
            <strong>
                <h4><a href="{% url 'blog:blog_details' item.pk %}">{{item.title}}</a></h4>
            </strong>
            <time>{{item.date_published|date:"F d"}} &bullet; {{item.readtime_min}} min</time>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
<div class="sidebar">
    <!-- End sidebar recent posts-->
    <h3 class="sidebar-title  mb-4" style="font-size: 24px;">Tags in blog</h3>
    <div class="sidebar-item tags">
        <ul>
            {% for tag in post.tags.all %}
            <li><a href="{% url 'blog:post_list_by_tags' tag.slug %}">{{tag}}</a></li>
            {% endfor %}
        </ul>
    </div>
    <!-- End sidebar tags-->
</div>
<div class="sidebar">
    Ads To Be shown here
</div>
{% endblock sidebar %}


{% block social-btn %}
<div class="social-box" style="height:fit-content;">
    <div class="sticky-container">
        <div class="container" style="justify-content: center;padding:5px;">
        {% if request.user.is_authenticated %}
            {% if is_liked %}
                <button class="like-button" title="Like" value="{{post.pk}}"><h5><i id="like-icon" class="bi bi-heart-fill"></i></h5></button>
            {% else %}
                <button class="like-button" value="{{post.pk}}"><h5><i id="like-icon" class="bi bi-heart"></i></h5></button>
            {% endif %}
        {% else %}
            <button class="like-button" value="{{post.pk}}"><h5><i id="like-icon" class="bi bi-heart"></i></h5></button>
        {% endif %}
        </div>
    </div>
    <div class="sticky-container" style="margin-top:40px;background:#3b5999;">
        <div class="container" style="justify-content: center;padding:5px;">
        <h5><i class="bi bi-bookmarks"></i></h5>
        </div>
    </div>
</div>
{% endblock social-btn %}

{% block pagination %}
<button class="like-button" value="{{post.pk}}"> Like Post</button>
{% endblock pagination %}