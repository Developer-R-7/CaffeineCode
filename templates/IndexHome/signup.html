{% extends 'IndexHome/base_ver.html' %}
{% block title %}{% endblock title %}

{% block body %}
<div class="login-root">
    <div class="box-root flex-flex flex-direction--column" style="min-height: 100vh;flex-grow: 1;">
      <div class="loginbackground box-background--white padding-top--64">
        <div class="loginbackground-gridContainer">
          <div class="box-root flex-flex" style="grid-area: top / start / 8 / end;">
            <div class="box-root" style="background-image: linear-gradient(white 0%, rgb(247, 250, 252) 33%); flex-grow: 1;">
            </div>
          </div>
        </div>
      </div>
      <div class="box-root padding-top--24 flex-flex flex-direction--column" style="flex-grow: 1; z-index: 9;">
        <div class="box-root padding-top--48 padding-bottom--24 flex-flex flex-justifyContent--center">
          <h1><a rel="dofollow" style="font-size:35px;">CaffeineCode</a></h1>
        </div>
        <div class="formbg-outer" style="margin-bottom: 20px;">
          <div class="formbg">
            <div class="formbg-inner padding-horizontal--48">
              <center><span class="padding-bottom--15" style="color: #c2c2c2;font-size:14px;">Create a new account</span></center>
              <br>
              <form role="form" method="POST" action="{% url 'IndexHome:signup' %}" id="stripe-login">
                {% csrf_token %}

                <div class="field padding-bottom--24">
                    <div class="grid--50-50">
                        <label for="password">Username</label>
                    </div>
                    <input id="username"  name="username" required spellcheck="false" style="margin-bottom:4px;" type="text" autocomplete="off" pattern="^(?=[a-zA-Z0-9._]{8,20}$)(?!.*[_.]{2})[^_.].*[^_.]$" title="Your username must consist of alphanumeric characters underscore(_),and period(.) underscore and period can't be first or last charcter and next to each other.">
                    <div id="error" style="color: red;font-size:15px;margin-bottom:12px;"></div>
                  <div class="grid--50-50">
                    <label for="password">Email</label>
                  </div>
                  <input  name="email"  spellcheck="false" style="margin-bottom:12px;" type="email" autocomplete="off" required>  


                  <div class="grid--50-50">
                    <label for="password">Password</label>
                  </div>
                  <input  name="password" required spellcheck="false" type="password" autocomplete="off">
                  {% if error %}
                    <div style="color: red;font-size:15px;margin-top:14px;">{{error}}</div>
                  {% endif %}
                </div>
        
                <div class="field padding-bottom--24">
                  <input class="enableOnInput" type="submit" name="submit" value="Login">
                </div>
              </form>
            </div>
          </div>
          <script>
            function delay(callback, ms) {
               var timer = 0;
               return function() {
                 var context = this, args = arguments;
                 clearTimeout(timer);
                 timer = setTimeout(function () {
                   callback.apply(context, args);
                 }, ms || 0);
               };
             }
            $(document).ready(function () {
                // catch the form's submit event
                $('#username').keyup(delay(function (e) {
                    // create an AJAX call
                    $.ajax({
                        data: $(this).serialize(),// get the form data
                        url: "{% url 'IndexHome:check_user' %}",
                        // on success
                        success: function (response) {
                            if (response.is_taken == true) {
                                $('#error').html("Username already taken!")
                                $('.enableOnInput').prop('disabled', true);
                            }
                            else {
                                $('.enableOnInput').prop('disabled', false);
                                $('#error').html("");
            
                            }
            
                        },
                        // on error
                        error: function (response) {
                            // alert the error if any error occured
                            console.log(response.responseJSON.errors)
                        }
                    });
                    return false;
                },500));
            })
          </script>
          <div class="footer-link padding-top--24">
            <div style="text-align:center;color:#c9c9c9;font-family:Arial;font-size:11px;line-height:150%;">
                <p style="text-align:left;margin:0;margin-top:2px;text-align:center;">CaffeineCode | Surat, Gujarat, 395009 | Copyright © 2021 | All rights reserved</p>
            </div>
            <div class="listing  flex-flex center-center" style="margin-top:10px;">
                <span><a href="#">© CaffeineCode</a></span>
                <span><a href="#">Contact</a></span>
                <span><a href="#">Privacy & terms</a></span>
            </div>
          </div>
        </div>
      </div>
    </div>
</div>
{% endblock body %}